---
title: "Apresentação ggplot2 e lattice"
subtitle: "Alunos: Pedro, Victor e David"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introdução ao ggplot2

ggplot2 é uma biblioteca do R que permite criar, declarativamente, gráficos e customizá-los. Com dados e variáveis para serem mapeadas, o ggplot2 cuida do restante do gráfico, deixando opções estéticas a cargo do programador. 

ggplot2 é considerada a biblioteca mais elegante para criação de gráficos disponível em R. A seguir, vamos mostrar uma breve introdução ao ggplot2, mostrando alguns recursos e como customizar os gráficos. 

O primeiro passo, naturalmente, é instalar e importar a biblioteca.
```{r, echo=FALSE}
# install.packages("ggplot2")
```

```{r, echo=FALSE}
library(ggplot2)
```

Para essa introdução, usaremos a base de dados que já vem embutida ao ggplot2, chamada midwest. 
```{r, echo=TRUE}
options(scipen=999) # Desliga a notação científica
data("midwest", package = "ggplot2")
head(midwest, n = 5) # Mostrando as primeiras 5 linhas
```
#### Criando um gráfico básico
Chamaremos a função ggplot, diremos o dataframe, os eixos e o tipo do gráfico. 
```{r}
ggplot(midwest, aes(x=area, y=poptotal)) + geom_point()
```

Compare com o mesmo gráfico com o R base. 
```{r, echo=FALSE}
plot(midwest$area, midwest$poptotal)
```

Podemos ver que o gráfico com ggplot2 saiu muito melhor. Mesmo assim, ainda há problemas com ele. Não está claro o que ele quer dizer. Não há títulos, legendas e ele ainda não está muito bonito. 

Vamos dar alguns passos para melhor a visualização das informações. Primeiro, vamos adicionar uma linha e sem seguida vamos dar um zoom no gráfico, para melhorar a visualização.  
```{r, echo=FALSE}
g <- ggplot(midwest, aes(x=area, y=poptotal)) + geom_point() + geom_smooth(method="lm") 
g <- g + coord_cartesian(xlim=c(0,0.1), ylim=c(0, 1000000))
plot(g)
```

Ficou um pouco melhor, mas ainda podemos melhorar. Vamos adicionar um título e renomear os eixos. 
```{r, echo=FALSE}
g <- g + labs(title="Área x População", subtitle="Por condado, retirado do dataset 'midwest'", y="População", x="Área")
plot(g)
```

Podemos customizar o gráfico, mudando a cor da linha e a cor dos pontos, além do tamanho dos pontos.
```{r, echo=FALSE}
g <- ggplot(midwest, aes(x=area, y=poptotal)) + geom_point(col="steelblue", size=2) + geom_smooth(method="lm", col="darkred") + coord_cartesian(xlim=c(0,0.1), ylim=c(0, 1000000)) + labs(title="Área x População", subtitle="Por condado, retirado do dataset 'midwest'", y="População", x="Área")
plot(g)
```

No entanto, podemos deixar a visualização ainda mais interessante. E se as cores dos pontos representassem uma coluna do dataframe? Isso é possível de fazer da seguinte forma:
```{r, echo=FALSE}
g <- ggplot(midwest, aes(x=area, y=poptotal)) + geom_point(aes(col=state), size=2) + geom_smooth(method="lm", col="darkred", size=1) + coord_cartesian(xlim=c(0,0.1), ylim=c(0, 1000000)) + labs(title="Área x População", subtitle="Por condado, retirado do dataset 'midwest'", y="População", x="Área")
plot(g)
```

Muito melhor! Agora, podemos colocar um fundo branco da seguinte forma:
```{r, echo=FALSE}
g <- g + theme_classic()
plot(g)
```

Assim, vimos algumas funções básicas do ggplot2 e verificamos o ponto forte da biblioteca, que é a criação de gráficos de uma maneira simples e bonita. 

## Introdução ao Lattice
o Lattice é um importante pacote de analise gráfica que antecedeu o ggplot2.
Útil para preparar painéis com gráficos de forma automatizada. 
Combinado com a leitura automática de arquivos de dados, torna a repetitiva visualização de dados e preparação de gráficos muito eficiente. 

Instalando e carregando o pacote lattice
```{r, echo=FALSE}
#install.packages("lattice")

library(lattice)     # carrega o pacote lattice
?lattice             # mostra ajuda do lattice
```

Para os exemplos será usada a base "Cars93"

```{r, echo=FALSE}

# para carregar a base de dados
library(MASS) # carrega o pacote "MASS" que contém a base de dados
data(Cars93)  # carrega a base de dados "Cars93"
head(Cars93, n = 5)

```

#### Criando um gráfico básico
O gráfico é preparado com o comando básico xyplot.
No comando os dados MPG.city são plotados versus EngineSize através da expressão "MPG.city ~ EngineSize" para o conjunto de dados total Cars93.

```{r, echo=FALSE}

# um dos tipos de gráficos do pacote lattice
xyplot(MPG.city ~ EngineSize, Cars93)

```

Outros comandos disponíveis são barchart, bwplot, densityplot, dotplot, histogram, etc.

#### Selecionando dados a serem plotados
Dados São selecionados através da função subset

```{r, echo=FALSE}
data <- subset(Cars93, Manufacturer %in% 
               c('Ford', 'Chevrolet', 'Toyota', 'Honda'))
head(data, n = 5)
```

#### Diferentes painéis
O lattice aparece de forma importante quando precisamos de gráficos com maiores detalhes, separados de acordo com outros fatores.
Em vez de plotar tudo junto como no gráfico acima, a mesma informação pode ser plotada de forma separada por fabricante (Manufacturer), usando o símbolo "|".

```{r, echo=FALSE}
# seleciona dados de quatro fabricantes para trabalhar 
data <- subset(Cars93, Manufacturer %in% 
               c('Ford', 'Chevrolet', 'Toyota', 'Honda')) 

xyplot(MPG.city ~ EngineSize | Manufacturer, data)
```

Podemos separar os dados ainda mais, por exemplo, por tipo de carro ("Type") usando a opção group. A função auto.key, que adiciona a legenda.

```{r, echo=FALSE}
xyplot(MPG.city ~ EngineSize | Manufacturer, data, 
       group = Type, auto.key = T)
```

#### Níveis de classificação

A fórmula da função xyplot abaixo apresenta o rendimento do carro (MPG.city) versus tamanho do motor (EngineSize) de acordo com o tamanho do carro e dividido entre carros produzidos dentro e fora dos EUA, por número de passageiros.

```{r, echo=FALSE}
# seleciona apenas três tipos de carro
data <- subset(Cars93, Type %in% c('Compact', 'Small', 'Large'))

# plota de acordo com origem, tipo e por número de passageiros
xyplot(MPG.city ~ EngineSize | Origin + Type, data, 
       group = Passengers,
       auto.key = list(space = 'right'))
```

#### Legenda
A legenda pode ser colocada em lugar mais apropriado.

```{r, echo=FALSE}
xyplot(MPG.city ~ EngineSize | Manufacturer, data, 
       group = Type, auto.key = list(space = 'right'))
```

Para outras opções:


```{r, echo=FALSE}
# legenda do lado direito:
auto.key = list(space = 'right')

# legenda em cima, em 3 colunas
auto.key = list(space = 'top', columns = 3)

# legenda dentro do gráfico
auto.key = list(corner = c(0, 0.85))
```

Mudar o tipo da legenda:

```{r, echo=FALSE}
# legenda com linhas, sem pontos
auto.key = list(points = F, lines = T)
```

#### Título e nome dos eixos

Para colocar um título no gráfico e mudar o nome dos eixos, use respectivamente main, xlab e ylab:

```{r, echo=FALSE}
xyplot(MPG.city ~ EngineSize | Manufacturer, data, 
     group = Type, 
     auto.key = list(space = 'right'),
     main = 'Relação entre rendimento e motor',
     xlab = 'tamanho do motor (litros)',
     ylab = 'rendimento (milhas por galão)')
```

#### Tipo de gráfico

```{r, echo=FALSE}
# pontos
xyplot(MPG.city ~ EngineSize | Manufacturer, data, type = 'p')

# linhas
xyplot(MPG.city ~ EngineSize | Manufacturer, data, type = 'l')   

# linhas e pontos
xyplot(MPG.city ~ EngineSize | Manufacturer, data, type = 'o')
```

